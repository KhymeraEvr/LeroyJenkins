@model WebStore.Models.Calcmodel

<form asp-controller="Home" asp-action="RunGaus">
    <input asp-for="size" id="sizeInput" type="text" placeholder="input matrix size" />
    <button type="submit">submit</button>
</form>
<script src="~/lib/signalr/dist/browser/signalr.js"></script>


<div id="chat" style="display: none">
    <h3 id="spn-nick"></h3>
    <form id="frm-send-message" action="#">
        <label for="message">Message:</label>
        <input type="text" id="message" />
        <input type="submit" id="send" value="Send" class="send" />
    </form>
    <div class="clear">
    </div>
    <ul id="messages"></ul>
</div>

<button onclick="getHistory()">History</button>
<table id="history" class="table" border="1"></table>

<script>
    function getHistory() {
        $.getJSON("getHistory", function (data)  {
            getTable("history", data);
        } )
    }
    function startCalc() {
        var size = document.getElementById("sizeInput").value;
        fetch("startCalc/" + size, {
            method: 'POST'
        });
    }
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chat")
        .build();

    connection.start().catch(err => console.error(err.toString()));
    connection.on('Send', (name, message) => {
        appendLine(name, message);
    });

    function appendLine(nick, message) {
        let nameElement = document.createElement('strong');
        nameElement.innerText = `${nick}:`;

        let msgElement = document.createElement('em');
        msgElement.innerText = ` ${message}`;
        console.log(nick + "    ->   " + message);
        let li = document.createElement('li');
        li.appendChild(nameElement);
        li.appendChild(msgElement);

        $('#messages').append(li);
    };

    function getTable(selector, data) {
        $("#"+selector+" tr").remove(); 
        var table = document.getElementById(selector)
        var tr = table.insertRow(-1);

        var col = [];
        for (var i = 0; i < data.length; i++) {
            for (var key in data[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        for (var i = 0; i < data.length; i++) {

            tr = table.insertRow(-1);

            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = data[i][col[j]];
            }
        }
    }
</script>